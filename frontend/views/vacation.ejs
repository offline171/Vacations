<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vacation Spots</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>
<body>
    <header>
        <h1>Vacation Spot</h1>
    </header>
    <ul>
        <li><a href="/" class="active">See Vacations</a></li>
        <li><a href="/ratings">See Ratings</a></li>
        <li><a href="/bookmarks">See Bookmarks</a></li>
        <li style="float:right"><a href="/users">See Users</a></li>
    </ul>
    <% if(bookmarked) { %>
        <form action="/bookmarks/<%= id %>/delete?_method=DELETE" method="POST">
            <button type="submit">Remove Bookmark</button>
        </form>
    <% } else {%>
        <form action="/bookmarks/<%= id %>" method="POST">
            <button type="submit">Add Bookmark</button>
        </form>
    <% } %>
    <br/>
    <a href="/<%= id %>/image-form">Add Images</a>
    <% if(images && images.length > 0) { %>
        <h3>Images:</h3>
        <ul>
            <% for (var i = 0; i < images.length; i++) { %>
                <li>
                    <img src="<%= images[i].url %>" alt="Vacation Image" style="max-width:300px; max-height:200px;"/>
                </li>
            <% } %>
        </ul>
    <% } %>
    <li>
        <h2><%= vacation.name %></h2>
        <p>Location: <%= vacation.location %></p>
        <p><%= vacation.description %></p>
    </li>
    <% if(!locals.user) { %>
        <h3>Log in to rate this vacation</h3>
    <% } else { %>
        <form action="/ratings/<%= id %>" method="POST">
            <label for="review">Rate this vacation (1-5):</label>
            <br/>
            <input id="review" name="review" type="number" min="1" max="5" required />
            <br/>
            <label for="comment">Leave a comment:</label>
            <br/>
            <textarea id="comment" name="comment" rows="4" cols="50"></textarea>
            <br/>
            <button type="submit">Submit Rating</button>
        </form>
    <% } %>
    <h3>Ratings:</h3>
    <% if (ratings && ratings.length > 0) { %>
        <ul>
            <% for (var i = 0; i < ratings.length; i++) { %>
                <li>
                    <p>User: <%= ratings[i].user_name %></p>
                    <p>Rating: <%= ratings[i].review %></p>
                    <p>Comment: <%= ratings[i].comment %></p>
                    <% if(ratings[i].created_at != ratings[i].updated_at){ %>
                        <p>edited</p>
                    <% } %>
                    <% //remember to add comments to ratings. Also the name "review" being for the number rating is misleading %>
                    <% if(locals.user && locals.user.id == ratings[i].user_id) { %>
                        <button id="toggleButton">Edit Your Rating</button>"
                        <form id="hiddenTextBox" action="/ratings/<%= ratings[i].id %>?_method=PUT" method="POST">
                            <label for="review">Rate this vacation (1-5):</label>
                            <input id="review" name="review" type="number" min="1" max="5" value="<%= ratings[i].review %>" required />
                            <br/>
                            <label for="comment">Leave a comment:</label>
                            <textarea id="comment" name="comment" rows="4" cols="50"><%= ratings[i].comment %></textarea>
                            <br/>
                            <button type="submit">Submit</button>
                        </form>
                        <form action="/ratings/<%= ratings[i].id %>?_method=DELETE" method="POST">
                            <button type="submit" onclick="return confirm('Are you sure you want to delete your rating?');">Delete Your Rating</button>
                        </form>
                    <% } %>
                </li>
            <% } %>
        </ul>
    <% } else { %>
        <p>No ratings yet. Be the first to rate this vacation!</p>
    <% } %>
</body>